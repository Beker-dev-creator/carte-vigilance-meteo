<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carte Vigilance M√©t√©o France</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        #map-container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }
        #map {
            height: 700px;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        .legend {
            padding: 10px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            line-height: 1.5;
        }
        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.7;
        }
        .controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
        }
        .picto-selector {
            margin-top: 10px;
        }
        .picto-btn {
            font-size: 20px;
            padding: 5px 10px;
            margin: 2px;
            cursor: pointer;
            background: #f0f0f0;
            border: none;
            border-radius: 4px;
        }
        .picto-btn:hover {
            background: #ddd;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .info {
            padding: 6px 8px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            background: white;
            background: rgba(255,255,255,0.8);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 5px;
        }
        .info h4 {
            margin: 0 0 5px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Carte de Vigilance M√©t√©orologique</h1>
    <div id="map-container">
        <div id="map"></div>
    </div>

    <script>
        // Initialisation de la carte
        const map = L.map('map').setView([46.5, 2], 6);

        // Ajout du fond de carte
        L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap France | Donn√©es cartographiques ¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
            maxZoom: 20
        }).addTo(map);

        // Couleurs de vigilance
        const vigilanceColors = {
            'Vert': '#4CAF50',
            'Jaune': '#FFEB3B',
            'Orange': '#FF9800',
            'Rouge': '#F44336'
        };

        // Pictogrammes m√©t√©o
        const pictograms = {
            'Soleil': '‚òÄÔ∏è',
            'Pluie': 'üåßÔ∏è',
            'Orage': '‚õàÔ∏è',
            'Neige': '‚ùÑÔ∏è',
            'Vent': 'üå¨Ô∏è',
            'Brouillard': 'üå´Ô∏è'
        };

        // Donn√©es des d√©partements (simplifi√©es)
        const departements = {
            "01": {name: "Ain", vigilance: "Vert", picto: "Soleil"},
            "02": {name: "Aisne", vigilance: "Jaune", picto: "Pluie"},
            "03": {name: "Allier", vigilance: "Vert", picto: "Soleil"},
            "04": {name: "Alpes-de-Haute-Provence", vigilance: "Orange", picto: "Vent"},
            "05": {name: "Hautes-Alpes", vigilance: "Rouge", picto: "Neige"},
            // ... Ajoutez tous les d√©partements ici
            "75": {name: "Paris", vigilance: "Jaune", picto: "Pluie"},
            "76": {name: "Seine-Maritime", vigilance: "Orange", picto: "Vent"}
        };

        // Chargement des contours des d√©partements
        fetch('https://france-geojson.gregoiredavid.fr/repo/departements.geojson')
            .then(response => response.json())
            .then(data => {
                const geojson = L.geoJson(data, {
                    style: function(feature) {
                        const deptCode = feature.properties.code;
                        const deptData = departements[deptCode] || {vigilance: "Vert"};
                        return {
                            fillColor: vigilanceColors[deptData.vigilance],
                            weight: 1,
                            opacity: 1,
                            color: 'white',
                            fillOpacity: 0.7
                        };
                    },
                    onEachFeature: function(feature, layer) {
                        const deptCode = feature.properties.code;
                        const deptData = departements[deptCode] || {name: feature.properties.nom, vigilance: "Vert"};
                        
                        // Info-bulle
                        layer.bindPopup(`
                            <strong>${deptData.name}</strong><br>
                            Vigilance: ${deptData.vigilance}<br>
                            Ph√©nom√®ne: ${deptData.picto} ${pictograms[deptData.picto] || ''}
                        `);
                        
                        // Gestion du clic pour modifier
                        layer.on('click', function(e) {
                            selectedDept = deptCode;
                            updateSelectedDept();
                        });
                    }
                }).addTo(map);

                // L√©gende
                const legend = L.control({position: 'bottomright'});
                legend.onAdd = function(map) {
                    const div = L.DomUtil.create('div', 'legend info');
                    div.innerHTML = '<h4>L√©gende</h4>';
                    
                    for (const [level, color] of Object.entries(vigilanceColors)) {
                        div.innerHTML += 
                            `<i style="background:${color}"></i> ${level}<br>`;
                    }
                    
                    div.innerHTML += '<h4>Pictogrammes</h4>';
                    for (const [name, picto] of Object.entries(pictograms)) {
                        div.innerHTML += `${picto} ${name}<br>`;
                    }
                    
                    return div;
                };
                legend.addTo(map);

                // Contr√¥les interactifs
                const controls = L.control({position: 'topright'});
                controls.onAdd = function(map) {
                    const div = L.DomUtil.create('div', 'controls');
                    div.innerHTML = '<h4>Modifier d√©partement</h4>';
                    
                    // S√©lecteur de vigilance
                    div.innerHTML += '<select id="vigilance-select">';
                    for (const level in vigilanceColors) {
                        div.innerHTML += `<option value="${level}">${level}</option>`;
                    }
                    div.innerHTML += '</select>';
                    
                    // S√©lecteur de pictogramme
                    div.innerHTML += '<div class="picto-selector">';
                    for (const [name, picto] of Object.entries(pictograms)) {
                        div.innerHTML += 
                            `<button class="picto-btn" data-picto="${name}">${picto}</button>`;
                    }
                    div.innerHTML += '</div>';
                    
                    return div;
                };
                controls.addTo(map);

                // Gestion des interactions
                let selectedDept = null;
                
                function updateSelectedDept() {
                    if (!selectedDept) return;
                    
                    const vigilance = document.getElementById('vigilance-select').value;
                    departements[selectedDept].vigilance = vigilance;
                    
                    // Mise √† jour de la carte
                    geojson.setStyle(function(feature) {
                        if (feature.properties.code === selectedDept) {
                            return {
                                fillColor: vigilanceColors[vigilance],
                                weight: 2,
                                color: '#000',
                                fillOpacity: 0.7
                            };
                        }
                        return {
                            fillColor: vigilanceColors[departements[feature.properties.code]?.vigilance || "Vert"],
                            weight: 1,
                            color: 'white',
                            fillOpacity: 0.7
                        };
                    });
                }
                
                // √âcouteurs d'√©v√©nements
                document.getElementById('vigilance-select').addEventListener('change', updateSelectedDept);
                
                document.querySelectorAll('.picto-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        if (selectedDept) {
                            departements[selectedDept].picto = this.dataset.picto;
                            // On pourrait actualiser le popup ici
                        }
                    });
                });
            })
            .catch(error => console.error('Erreur de chargement des donn√©es:', error));
    </script>
</body>
</html>
